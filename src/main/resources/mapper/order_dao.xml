<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="fzz.wsback.dao.OrderDao">
    <resultMap type="fzz.wsback.domain.OrderInfo"
               id="OrderResultMap">
        <id column="order_id" property="orderId" jdbcType="INTEGER"/>
        <result column="user_address" property="userAddress" jdbcType="VARCHAR"/>
        <result column="user_id" property="userId" jdbcType="INTEGER"/>
        <result column="user_phone" property="userPhone" jdbcType="VARCHAR"/>
        <result column="business_id" property="businessId" jdbcType="INTEGER"/>
        <result column="book_id" property="bookId" jdbcType="INTEGER"/>
        <result column="book_name" property="bookName" jdbcType="VARCHAR"/>
        <result column="book_image_path" property="bookImagePath" jdbcType="VARCHAR"/>
        <result column="book_number" property="bookNumber" jdbcType="INTEGER"/>
        <result column="total_price" property="totalPrice" jdbcType="DOUBLE"/>
    </resultMap>

    <!-- 通过订单 ID 获取订单信息 -->
    <select id="getOrderInfoByOrderId" resultMap="OrderResultMap" parameterType="fzz.wsback.domain.OrderInfo">
        SELECT *
        FROM order_info
        WHERE order_id = #{orderId}
    </select>

    <!-- 通过用户 ID 获取用户所有订单信息 -->
    <select id="getOrderInfoListByUserId" resultMap="OrderResultMap" parameterType="java.lang.Integer">
        SELECT *
        FROM order_info
        WHERE user_id = #{userId}
    </select>

    <!-- 通过店铺 ID 获取店铺订单信息 -->
    <select id="getOrderInfoListByBusinessId" resultMap="OrderResultMap" parameterType="fzz.wsback.domain.OrderInfo">
        SELECT *
        FROM order_info
        WHERE business_id = #{businessId}
        LIMIT #{firstIndex}, #{pageSize}
    </select>

    <!-- 通过店铺 ID 获取当前店铺总订单量 -->
    <select id="getOrderInfoCountByBusinessId" resultType="java.lang.Long" parameterType="java.lang.Integer">
        SELECT count(*)
        FROM order_info
        WHERE business_id = #{businessId}
    </select>

    <!-- 新建订单 -->
    <insert id="insertOrderInfo">
        INSERT
        INTO order_info (order_id, user_address, user_id, user_phone, business_id, book_id, book_name, book_image_path, book_number, total_price)
        VALUES (#{orderId}, #{userAddress}, #{userId}, #{userPhone}, #{businessId}, #{bookId}, #{bookName}, #{bookImagePath}, #{bookNumber}, #{totalPrice})
    </insert>

    <!-- 更新订单信息 -->
    <update id="updateOrderInfo" parameterType="fzz.wsback.domain.OrderInfo">
        UPDATE order_info
        SET user_address = #{userAddress}, user_phone = #{userPhone}
        WHERE order_id = #{orderId}
    </update>

    <!-- 通过订单 ID 删除订单 -->
    <delete id="deleteOrderInfoByOrderId" parameterType="fzz.wsback.domain.OrderInfo">
        DELETE
        FROM order_info
        WHERE order_id = #{orderId}
    </delete>
</mapper>
